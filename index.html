<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Morning Leave Plan</title>
<style>
:root{--paper:#F6F1EB;--ink:#5C4433;--sage:#7A8C5F;--line:rgba(0,0,0,.10);--warn:#7a4b00;--warnbg:#fff5e6;--late:#7a1f1f;--latebg:#fdebec;--r:20px;--pad:24px;}
body{margin:0;font-family:sans-serif;background:var(--paper);color:var(--ink);display:flex;justify-content:center;padding:40px;}
.leave-card{background:var(--paper);border:1px solid var(--line);border-radius:var(--r);padding:var(--pad);box-shadow:0 2px 8px rgba(0,0,0,.06);max-width:800px;width:100%;}
.lp-grid{display:grid;grid-template-columns:1.25fr 1fr 1fr 1fr;gap:14px 18px;align-items:end}
.lp-field{display:flex;flex-direction:column;gap:6px;color:var(--ink);font-size:14px}
.lp-input{background:transparent;border:none;border-bottom:1px dashed var(--line);padding:6px 2px;height:36px;font-size:17px;color:var(--ink);outline:none}
.lp-input:focus{border-bottom:1px solid var(--sage)}
.lp-input--num{width:64px;text-align:right}
.lp-input--time{-webkit-appearance:none;appearance:none;line-height:1.2}
.lp-input--time::-webkit-date-and-time-value{text-align:left}
.lp-field--row .lp-inline{display:flex;align-items:center;gap:6px}
.lp-step{border:1px solid var(--line);background:#fff;border-radius:12px;height:36px;min-width:44px;padding:0 10px;line-height:34px;font-size:14px;color:var(--ink)}
.lp-unit{font-size:14px;color:rgba(0,0,0,.6)}
.lp-results{grid-column:1 / -1;display:grid;grid-template-columns:1fr 1fr auto;gap:12px 16px;align-items:center;margin-top:8px}
.lp-result{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;min-height:48px}
.lp-label{display:flex;align-items:center;gap:8px;font-size:15px;color:rgba(0,0,0,.6)}
.lp-result strong{font-weight:800;color:var(--sage);letter-spacing:-0.02em;font-size:22px}
.lp-countwrap{display:grid;grid-auto-flow:column;align-items:center;gap:10px;justify-self:end;text-align:right}
.lp-ring{width:40px;height:40px}
.lp-ring__track{fill:none;stroke:var(--line);stroke-width:4}
.lp-ring__prog{fill:none;stroke:var(--sage);stroke-width:4;transform:rotate(-90deg);transform-origin:50% 50%}
.lp-count{display:inline-block;padding:10px 14px;border-radius:12px;font-weight:700;background:#eaf5ec;color:#1e5c36}
.lp-count--warn{background:var(--warnbg);color:var(--warn)}
.lp-count--late{background:var(--latebg);color:var(--late)}
.lp-counthint{font-size:12px;color:rgba(0,0,0,.6);margin-top:2px}
@media (max-width:980px){.lp-grid{grid-template-columns:repeat(2,minmax(160px,1fr))}.lp-results{grid-template-columns:1fr}.lp-countwrap{justify-self:start;text-align:left}}
</style>
</head>
<body>
<svg style="display:none" aria-hidden="true">
  <symbol id="ic-shoe" viewBox="0 0 24 24">
    <path fill="currentColor" d="M2 13v3h20v-2l-8-4-4 3H2z"/>
  </symbol>
  <symbol id="ic-door" viewBox="0 0 24 24">
    <path fill="currentColor" d="M3 2h18v20H3V2zm10 9a1 1 0 110 2 1 1 0 010-2z"/>
  </symbol>
</svg>
<section class="leave-card" aria-label="Leave plan">
  <div class="card-title" style="font-weight:700;font-size:22px;margin-bottom:12px;">Leave plan</div>
  <div class="lp-grid">
    <label class="lp-field">
      <span>Arrival</span>
      <input id="arriveTime" class="lp-input lp-input--time" type="time" value="08:45">
    </label>

    <label class="lp-field lp-field--row">
      <span>Commute</span>
      <div class="lp-inline">
        <button type="button" class="lp-step" data-target="commuteMin" data-delta="-5">−5</button>
        <input id="commuteMin" class="lp-input lp-input--num" type="number" min="0" value="25" inputmode="numeric">
        <span class="lp-unit">min</span>
        <button type="button" class="lp-step" data-target="commuteMin" data-delta="5">+5</button>
      </div>
    </label>

    <label class="lp-field lp-field--row">
      <span>Shoes lead</span>
      <div class="lp-inline">
        <button type="button" class="lp-step" data-target="shoesLeadMin" data-delta="-1">−1</button>
        <input id="shoesLeadMin" class="lp-input lp-input--num" type="number" min="0" value="5" inputmode="numeric">
        <span class="lp-unit">min</span>
        <button type="button" class="lp-step" data-target="shoesLeadMin" data-delta="1">+1</button>
      </div>
    </label>

    <label class="lp-field lp-field--row">
      <span>Buffer</span>
      <div class="lp-inline">
        <button type="button" class="lp-step" data-target="extraBufferMin" data-delta="-5">−5</button>
        <input id="extraBufferMin" class="lp-input lp-input--num" type="number" min="0" value="0" inputmode="numeric">
        <span class="lp-unit">min</span>
        <button type="button" class="lp-step" data-target="extraBufferMin" data-delta="5">+5</button>
      </div>
    </label>

    <div class="lp-results">
      <div class="lp-result">
        <div class="lp-label"><svg class="lp-mini"><use href="#ic-shoe"/></svg> Shoes</div>
        <strong id="shoesAt">—</strong>
      </div>
      <div class="lp-result">
        <div class="lp-label"><svg class="lp-mini"><use href="#ic-door"/></svg> Leave by</div>
        <strong id="leaveBy">—</strong>
      </div>
      <div class="lp-countwrap">
        <svg class="lp-ring" viewBox="0 0 36 36" aria-hidden="true">
          <circle class="lp-ring__track" cx="18" cy="18" r="16"></circle>
          <circle class="lp-ring__prog" cx="18" cy="18" r="16"></circle>
        </svg>
        <div id="leaveCountdown" class="lp-count">—</div>
        <div id="slackLabel" class="lp-counthint">No extra buffer</div>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  const $  = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  const arrive=$('#arriveTime'), commute=$('#commuteMin'), shoesLead=$('#shoesLeadMin'), extra=$('#extraBufferMin');
  const shoesAtEl=$('#shoesAt'), leaveByEl=$('#leaveBy'), countdownEl=$('#leaveCountdown'), slackEl=$('#slackLabel'), updatedEl=$('#planUpdated');

  const ringProg=document.querySelector('.lp-ring__prog'); const R=16, CIRC=2*Math.PI*R;
  if(ringProg){ ringProg.setAttribute('stroke-dasharray', CIRC); ringProg.setAttribute('stroke-dashoffset', CIRC); }

  // steppers (tap or press-and-hold)
  $$('.lp-step').forEach(btn=>{
    let hold;
    const tick=()=>{ const t=document.getElementById(btn.dataset.target); const d=+btn.dataset.delta; t.value=Math.max(0,(+t.value||0)+d); calc(); };
    btn.addEventListener('mousedown', ()=>{tick(); hold=setInterval(tick,160);});
    btn.addEventListener('mouseup',   ()=> clearInterval(hold));
    btn.addEventListener('mouseleave',()=> clearInterval(hold));
    btn.addEventListener('touchstart',(e)=>{e.preventDefault(); tick(); hold=setInterval(tick,160);},{passive:false});
    btn.addEventListener('touchend',  ()=> clearInterval(hold));
  });

  [arrive,commute,shoesLead,extra].forEach(el=>el.addEventListener('input', calc));

  function calc(){
    const arr=toMin(arrive.value), leave=arr - n(commute) - n(extra), shoes=leave - n(shoesLead);
    shoesAtEl.textContent=fmt(shoes); leaveByEl.textContent=fmt(leave);
    const buf=n(extra); slackEl.textContent=buf>0?`+${buf} min buffer`:'No extra buffer';
    if(updatedEl) updatedEl.textContent=new Date().toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
    paint(leave);
  }

  function paint(leave){
    const now=new Date(), nowMin=now.getHours()*60+now.getMinutes(), diff=Math.round(leave-nowMin);
    let cls='lp-count', label='';
    if(diff>5){ label=`Leave in ${diff} min`; }
    else if(diff>=0){ label=`Leave in ${diff} min`; cls+=' lp-count--warn'; }
    else { label=`Late by ${Math.abs(diff)} min`; cls+=' lp-count--late'; }
    countdownEl.className=cls; countdownEl.textContent=label;

    if(ringProg){ const WINDOW=30, p=Math.max(0,Math.min(1,1-(diff/WINDOW))); ringProg.setAttribute('stroke-dashoffset', String(CIRC*(1-p))); }
  }

  function n(el){ return parseInt(el.value||0,10); }
  function toMin(hm){ const [h,m]=(hm||'00:00').split(':').map(Number); return h*60+m; }
  function fmt(mins){ let h=Math.floor(mins/60)%24; if(h<0) h=(24+(h%24))%24; let m=Math.abs(mins%60); const am=h>=12?'PM':'AM', h12=h%12===0?12:h%12; return `${h12}:${String(m).padStart(2,'0')} ${am}`; }

  // Ensure default commute=25 at load
  if(!commute.value || +commute.value===0) commute.value=25;
  calc(); setInterval(calc, 30000);
})();
</script>
</body>
</html>
